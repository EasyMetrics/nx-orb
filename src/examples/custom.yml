description: >
  You can use the `get-tag` and `set-tag` directly.
  Use `get-tag` before running your `nx affected...` calls.
  User `set-tag` as your last step. Set-tag will be skipped unless all of the previous steps were successful
usage:
  version: 2.1
  orbs:
    nx-tag-successful-ci-run: nrwl/nx-tag-successful-ci-run@1.0.0
  jobs:
    build:
      docker:
        - image: cimg/node:14.17-browsers
      steps:
        - checkout
        - run:
            name: Install dependencies
            command: yarn install --frozen-lockfile
        - nx-tag-successful-ci-run/set-shas:
            main-branch-name: "master"
            # Make sure this tag pattern matches the complementary set-tag
            tag-match-pattern: "my_custom_tag*"
            error-on-no-matching-tags: false
        - run:
            name: Run Builds
            command: yarn nx affected --target=build --base=$BASE_SHA
        - run:
            name: Run Unit Tests
            command: yarn nx affected --target=test --base=$BASE_SHA
        - nx-tag-successful-ci-run/tag-successful-ci-run:
            # Make sure your each tag is unique. Each run has a unique ${CIRCLE_WORKFLOW_ID}
            # But you can also use date - $(date +"%Y-%m-%d-%H%M") or something other
            command_string_to_echo_as_tag_name: "my_custom_tag_${CIRCLE_WORKFLOW_ID}"
